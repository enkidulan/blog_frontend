# The container definition we want to use for developing our app
box: enkidulan/blog_testing_env

build:
  steps:
#    - script:
#        name: installing env dependensies
#        code: |
#          dnf install -y -qq git
#          dnf install -y -qq node nodejs npm
#          dnf install -y -qq make xorg-x11-server-Xvfb
#          dnf install -y -qq firefox
#          npm install -g grunt-cli karma bower --quiet
    - script:
        name: installing frontend app dependencies
        code: |
          cd blog_frontend
          npm install --quiet
          npm install grunt --save-dev --quiet
          bower install grunt---allow-root --config.interactive=false
          bower install --allow-root  --config.interactive=false
    - script:
        name: grunt
        code: |
          Xvfb :99 -ac & export DISPLAY=:99
          dbus-uuidgen > /var/lib/dbus/machine-id
          grunt

#deploy:
#  enki_dist:
#  - add-ssh-key:
#      keyname: enkid_dist_ssh
#      host: $hostname
#  - add-to-known_hosts:
#        hostname: $hostname
#        # fingerprint: ce:83:e9:7d:02:a4:e3:63:3f:8a:07:cc:d5:d9:bb:cd
#  - script:
#      name: installing dependensies
#      code: |
#        pip install jarn.mkrelease
#        git config --global user.email "enkidulan@gmail.com"
#        git config --global user.name "wercker builder"
#        git config --global push.default simple
#  - add-ssh-key:
#      keyname: enkid_dist_ssh
#      host: github.com
#  - add-to-known_hosts:
#        hostname: github.com
#  - script:
#      name: releasing to dist
#      code: |
#        TAGNAME=`date +"v1.0.%Y%m%d%H%M"`
#        sed -ri s/version=\'v[\.0-9\-]+\'/version=\'$TAGNAME\'/g setup.py
#        git commit -m "Prepare version $TAGNAME [ci skip]" setup.py
#        git push origin master
#        mkrelease -C -d $enki_dist_url
#        git push origin master --tags
